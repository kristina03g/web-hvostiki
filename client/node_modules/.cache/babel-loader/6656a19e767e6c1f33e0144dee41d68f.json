{"ast":null,"code":"import { geometry as g, drawing as d } from '@progress/kendo-drawing';\nimport { Class, defined, isFunction, getter, setDefaultOptions } from '../../common';\nimport { ShapeLayer } from './shape';\nimport { Location } from '../location';\nexport var BubbleLayer = function (ShapeLayer) {\n  function BubbleLayer() {\n    ShapeLayer.apply(this, arguments);\n  }\n  if (ShapeLayer) BubbleLayer.__proto__ = ShapeLayer;\n  BubbleLayer.prototype = Object.create(ShapeLayer && ShapeLayer.prototype);\n  BubbleLayer.prototype.constructor = BubbleLayer;\n  BubbleLayer.prototype._readData = function _readData() {\n    var data = this.options.data || [];\n    return data;\n  };\n  BubbleLayer.prototype._load = function _load(data) {\n    var this$1 = this;\n    this._data = data;\n    this.surface.clear();\n    if (data.length === 0) {\n      return;\n    }\n    var options = this.options;\n    var getValue = getter(options.valueField);\n    var newData = data.slice(0);\n    newData.sort(function (a, b) {\n      return getValue(b) - getValue(a);\n    });\n    var scaleType = this._scaleType();\n    var scale;\n    var getLocation = getter(this.options.locationField);\n    for (var i = 0; i < newData.length; i++) {\n      var dataItem = newData[i];\n      var location = getLocation(dataItem);\n      var value = getValue(dataItem);\n      if (defined(location) && defined(value)) {\n        if (!scale) {\n          scale = new scaleType([0, value], [options.minSize, options.maxSize]);\n        }\n        location = Location.create(location);\n        var center = this$1.map.locationToView(location);\n        var size = scale.map(value);\n        var symbol = this$1._createSymbol({\n          center: center,\n          size: size,\n          style: options.style,\n          dataItem: dataItem,\n          location: location\n        });\n        symbol.dataItem = dataItem;\n        symbol.location = location;\n        symbol.value = value;\n        this$1._drawSymbol(symbol);\n      }\n    }\n  };\n  BubbleLayer.prototype._scaleType = function _scaleType() {\n    var scale = this.options.scale;\n    if (isFunction(scale)) {\n      return scale;\n    }\n    return Scales[scale];\n  };\n  BubbleLayer.prototype._createSymbol = function _createSymbol(args) {\n    var symbol = this.options.symbol;\n    if (!isFunction(symbol)) {\n      symbol = Symbols[symbol];\n    }\n    return symbol(args);\n  };\n  BubbleLayer.prototype._drawSymbol = function _drawSymbol(shape) {\n    var args = {\n      layer: this,\n      shape: shape\n    };\n    var cancelled = this.map.trigger('shapeCreated', args);\n    if (!cancelled) {\n      this.surface.draw(shape);\n    }\n  };\n  BubbleLayer.prototype._tooltipContext = function _tooltipContext(shape) {\n    return {\n      type: 'bubble',\n      layerIndex: this._layerIndex(),\n      className: 'k-map-bubble-tooltip',\n      dataItem: shape.dataItem,\n      location: shape.location,\n      value: shape.value\n    };\n  };\n  BubbleLayer.prototype._tooltipAnchor = function _tooltipAnchor(e) {\n    var shape = e.element;\n    var center = shape.bbox().center();\n    return {\n      top: center.y,\n      left: center.x\n    };\n  };\n  return BubbleLayer;\n}(ShapeLayer);\nsetDefaultOptions(BubbleLayer, {\n  // autoBind: true,\n  locationField: 'location',\n  valueField: 'value',\n  minSize: 0,\n  maxSize: 100,\n  scale: 'sqrt',\n  symbol: 'circle',\n  // ensure bubble layers are displayed over tile and shape layers\n  zIndex: 200\n});\nvar SqrtScale = function (Class) {\n  function SqrtScale(domain, range) {\n    Class.call(this);\n    this._domain = domain;\n    this._range = range;\n    var domainRange = Math.sqrt(domain[1]) - Math.sqrt(domain[0]);\n    var outputRange = range[1] - range[0];\n    this._ratio = outputRange / domainRange;\n  }\n  if (Class) SqrtScale.__proto__ = Class;\n  SqrtScale.prototype = Object.create(Class && Class.prototype);\n  SqrtScale.prototype.constructor = SqrtScale;\n  SqrtScale.prototype.map = function map(value) {\n    var rel = (Math.sqrt(value) - Math.sqrt(this._domain[0])) * this._ratio;\n    return this._range[0] + rel;\n  };\n  return SqrtScale;\n}(Class);\nvar Scales = {\n  sqrt: SqrtScale\n};\nvar Symbols = {\n  circle: function circle(args) {\n    var geo = new g.Circle(args.center, args.size / 2);\n    return new d.Circle(geo, args.style);\n  },\n  square: function square(args) {\n    var path = new d.Path(args.style);\n    var halfSize = args.size / 2;\n    var center = args.center;\n    path.moveTo(center.x - halfSize, center.y - halfSize).lineTo(center.x + halfSize, center.y - halfSize).lineTo(center.x + halfSize, center.y + halfSize).lineTo(center.x - halfSize, center.y + halfSize).close();\n    return path;\n  }\n};","map":null,"metadata":{},"sourceType":"module"}